<?xml version="1.0" encoding="UTF-8"?>
<lkk:template xmlns:lkk="http://www.github.com/lukke100"
              xmlns:xi="http://www.w3.org/2001/XInclude">

  <xi:include href="../../shared-config.xml" xpointer="xpointer(/*/node())"/>

  <lkk:content>
#!/usr/bin/env sh
# shellcheck disable=SC2139

if [ -z "$PS1" ]
then
  return
fi

export COLORFGBG
export GREP_COLORS
export HISTFILE
export HISTFILESIZE
export HISTSIZE
export LESS
export LESS_TERMCAP_mb
export LESS_TERMCAP_md
export LESS_TERMCAP_me
export LESS_TERMCAP_se
export LESS_TERMCAP_so
export LESS_TERMCAP_ue
export LESS_TERMCAP_us
export LESSHISTFILE
export PROMPT_COMMAND
export PS2
export PS3
export PS4

if [ -n "$BASH" ]
then
  # shellcheck disable=SC2039
  shopt -s checkwinsize histappend

  # shellcheck disable=SC2039
  SOURCE_DIR=$(dirname "$(realpath "${BASH_SOURCE[0]}")")
else
  # TODO: determine SOURCE_DIR in a POSIX-compliant way
  SOURCE_DIR=''
fi

COLORFGBG='default;default'
GREP_COLORS='ms=01;31:mc=01;31:sl=:cx=:fn=35:ln=32:bn=32:se=36'
HISTFILE=$HOME/.cmd_history
LESS_TERMCAP_mb=$(printf '\033[01;31m')
LESS_TERMCAP_md=$(printf '\033[01;31m')
LESS_TERMCAP_me=$(printf '\033[0m')
LESS_TERMCAP_se=$(printf '\033[0m')
LESS_TERMCAP_so=$(printf '\033[01;44;33m')
LESS_TERMCAP_ue=$(printf '\033[0m')
LESS_TERMCAP_us=$(printf '\033[01;32m')
LESS='-FRXis'
LESSHISTFILE=/dev/null
PROMPT_COMMAND=$(cat "$SOURCE_DIR/.ignore.prompt-cmd.sh")
PS2='... '
PS3='> '
PS4='+ '

HISTFILESIZE=""
HISTSIZE=""

COLORTYPE='--color=auto'
DIRSFIRST='--group-directories-first'
TIMESTYLE='--time-style=long-iso'

alias dir="dir $COLORTYPE $DIRSFIRST $TIMESTYLE"
alias grep="grep $COLORTYPE"
alias info="info --vi-keys"
alias la="ls -A"
alias ll="ls -l"
alias ls="ls -1HLbh --file-type $COLORTYPE $DIRSFIRST $TIMESTYLE"
alias top=htop
alias vdir="vdir -A $COLORTYPE $DIRSFIRST $TIMESTYLE"

RM_EX_RGX='s/ex\=[0-9][0-9];[0-9][0-9]:/ex\=0:/'
eval "$(dircolors -b | sed -e "$RM_EX_RGX")"

BASH_COMPLETE=/usr/share/bash-completion/bash_completion
GIT_COMPLETE=/usr/share/git/completion/git-prompt.sh

if [ -r "$BASH_COMPLETE" ]
then
  # shellcheck disable=SC1090
  . "$BASH_COMPLETE"
fi

if [ -r "$GIT_COMPLETE" ]
then
  # shellcheck disable=SC1090
  . "$GIT_COMPLETE"
fi

if echo "$TERM" | grep -q linux
then
  USE_BACKGROUND=true

  printf '\033]P1<lkk:ref name="color-red"/>' # Red
  printf '\033]P2<lkk:ref name="color-green"/>' # Green
  printf '\033]P3<lkk:ref name="color-yellow"/>' # Yellow
  printf '\033]P4<lkk:ref name="color-blue"/>' # Blue
  printf '\033]P5<lkk:ref name="color-magenta"/>' # Magenta
  printf '\033]P6<lkk:ref name="color-cyan"/>' # Cyan
  printf '\033]P7<lkk:ref name="color-white"/>' # White
  printf '\033]P8<lkk:ref name="color-light-black"/>' # Light Black
  printf '\033]P9<lkk:ref name="color-light-red"/>' # Light Red
  printf '\033]PA<lkk:ref name="color-light-green"/>' # Light Green
  printf '\033]PB<lkk:ref name="color-light-yellow"/>' # Light Yellow
  printf '\033]PC<lkk:ref name="color-light-blue"/>' # Light Blue
  printf '\033]PD<lkk:ref name="color-light-magenta"/>' # Light Magenta
  printf '\033]PE<lkk:ref name="color-light-cyan"/>' # Light Cyan
  printf '\033]PF<lkk:ref name="color-light-white"/>' # Light White

  # changing background color doesn't fully apply unless `clear` is called
  if "$USE_BACKGROUND"
  then
    printf '\033]P0<lkk:ref name="color-black"/>' # Black
    clear
  fi
fi
  </lkk:content>
</lkk:template>
